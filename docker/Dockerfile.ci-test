FROM python:3.13-slim

# Install system dependencies (same as CI)
RUN apt-get update && apt-get install -y \
    ffmpeg \
    mediainfo \
    libsndfile1 \
    libopencv-dev \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy project files
COPY . .

# Install Python dependencies (same as CI)
RUN python -m pip install --upgrade pip && \
    pip install -e .[dev]

# Create test directories (same as CI)
RUN mkdir -p /tmp/music/{source,temp,metadata,screenshots} && \
    cp tests/files/* /tmp/music/source/ 2>/dev/null || true

# Copy and setup test script
RUN chmod +x scripts/run_ci_tests.sh

# Default command runs all CI tests using our script  
CMD ["./scripts/run_ci_tests.sh"]